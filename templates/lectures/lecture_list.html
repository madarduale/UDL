{% extends '../base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load class_name %}
{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
      
      <li class="breadcrumb-item active" aria-current="page">lectures</li>
    </ol>
</nav>

<h2>Lectures</h2>
{% if messages %}
    {% for message in messages %}
      {% if message.tags == 'error' %}
          <div class="alert alert-danger" style="width: 50%;  margin: auto;">
              {{ message }}
          </div>
      {%else %}
          <div class="alert alert-{{ message.tags }}" style="width: 50%;  margin: auto;">
              {{ message }}
          </div>
      {% endif %}
    {% endfor %}
{% endif %}

{% if user.is_superuser %}
<p> <a href="{% url 'lecture_create'%}"><i class="fa fa-plus" aria-hidden="true"></i></a></p>
{% endif %}

{% if  user.is_professor or user.is_admin %}
<!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
  <i class="fa fa-plus" aria-hidden="true"></i>
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create Lecture</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          {{ form.media }}
          {{ form | crispy }}
          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
      <!-- <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div> -->
    </div>
  </div>
</div>
{% endif %}
<br>
<br>

{% if grouped_by_course %}
{% if  user.is_student %}
<div class="accordion " id="accordionExample">
  {% for course, lectures in grouped_by_course.items %}
    <div class="accordion-item shadow p-3 mb-3 bg-body rounded border border-warning">
      <h2 class="accordion-header" id="heading{{course.id}}">
        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{course.id}}" aria-expanded="true" aria-controls="collapse{{course.id}}">
            {{ course.title }}
        </button>
      </h2>
      {% for lecture in lectures %}
      <div id="collapse{{course.id}}" class="accordion-collapse collapse show " aria-labelledby="heading{{course.id}}" data-bs-parent="#accordionExample">
        <div class="accordion-body ">
       
            <ul class="list-group border border-primary " >
              <li class="list-group-item">
                <a href="{% if lecture.is_completed or forloop.first %}{% url 'lecture_detail' lecture.pk %}{% else %}#{% endif %}">
                  {{ lecture.title }}
              </a>                
                {{lecture.description | truncatewords:10}}
                {% comment %}
                {{lecture.description | first_line}}
                {% endcomment %}
              </li>
          </ul>  
            
          </div>
      </div>
      {% endfor %}
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="accordion " id="accordionExample">
    {% for course, lectures in grouped_by_course.items %}
      <div class="accordion-item shadow p-3 mb-3 bg-body rounded border border-warning">
        <h2 class="accordion-header" id="heading{{course.id}}">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{course.id}}" aria-expanded="true" aria-controls="collapse{{course.id}}">
              {{ course.title }}
          </button>
        </h2>
        {% for lecture in lectures %}
        <div id="collapse{{course.id}}" class="accordion-collapse collapse show " aria-labelledby="heading{{course.id}}" data-bs-parent="#accordionExample">
          <div class="accordion-body ">
         
              <ul class="list-group border border-primary " >
                <li class="list-group-item">
                  <a href="{% url 'lecture_detail' lecture.pk %}">
                    {{ lecture.title }}
                </a>
                  {{lecture.description | truncatewords:10 | safe }}
                  {% comment %}
                  {{lecture.description | first_line}}
                  {% endcomment %}
                </li>
            </ul>
          </div>
        </div>
        {% endfor %}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% else %}
    <div class="alert alert-warning" style="width: 50%;  margin: auto;">
      No lectures
    </div>
    {% endif %}

{% endblock content %}
